<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game lobby</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="assets/common.css" rel="stylesheet" />
    <link href="assets/nes.min.css" rel="stylesheet" />
    <style>
        #roomsBox .room {
            background-color:white;
            border-radius:5px;
            border:1px solid #000;
            height: 200px;
            width: 200px;
            overflow: auto;
            cursor: pointer;
        }
        #newRoom {
            display: none;
        }
    </style>
    <script type="application/javascript">
        function loadRooms() {
            const ws = new WebSocket('ws://localhost:3000/lobby');

            ws.onopen = function () {
                console.log(`[CLIENT] open()`);
            };

            ws.onclose = function() {
                console.log('Connection was closed');
            };

            ws.onmessage = function (event) {
                const m = event.data;
                console.log(m);
                if (m == null || m.length == 0)
                    return;
                showRooms(JSON.parse(m));
            };
        }
        function showRooms(rooms) {
            const t = document.getElementById('roomsBox');
            t.innerHTML = '';
            let tr;
            for (let i = 0;i < rooms.length;i++) {
                const div = document.createElement('div');
                div.className = 'room';
                const span = document.createElement('span');
                span.innerHTML = rooms[i].roomName + '<br/>' + rooms[i].roomType;
                div.appendChild(span);
                let page;
                if (rooms[i].roomType == 'SNAKE')
                    page = 'snake.html';
                else if (rooms[i].roomType == 'DRAW')
                    page = 'draw.html';
                div.onclick = function() {
                    location.href = 'games/' + page + '?roomName=' + encodeURIComponent(rooms[i].roomName) + '&roomId=' + rooms[i].roomId;
                };
                t.appendChild(div);
            }
        }
        function showNewRoomOptions() {
            // showWelcome();
            document.getElementById('newRoom').style.display = 'block';
        }
        function createRoom() {
            const roomName = document.getElementById('roomName').value;
            const roomType = document.getElementById('roomType').value;
            location.href = 'games/' + roomType + '?roomName=' + encodeURIComponent(roomName);
        }
    </script>
</head>
<body onload="loadRooms();">
    <div>
        <button type="button" onclick="showNewRoomOptions();" class="nes-btn is-warning">Create a new room</button>
    </div>
    <div id="newRoom">
        <div>Name: <input type="text" id="roomName" class="nes-input" /></div>
        <div>
            Type: 
            <select id="roomType">
                <option value="draw.html">Draw and guess</option>
                <option value="snake.html">Snake</option>
            </select>
        </div>
        <div><button type="button" onclick="createRoom();">Next Step</button></div>
    </div>
    <div id="roomsBox"></div>
</body>
</html>
